<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Nuke Simulator</title>
<style>
    body { margin:0; background:#000; overflow:hidden; }
    #menu {
        position: fixed;
        top: 10px;
        left: 10px;
        background: rgba(0,0,0,0.6);
        padding: 10px;
        border-radius: 8px;
        color: white;
        font-family: Arial;
        z-index: 10;
    }
    select, button {
        width: 160px;
        padding: 5px;
        margin-top: 5px;
    }
</style>
</head>
<body>

<div id="menu">
    <b>Тип бомбы:</b><br>
    <select id="bomb">
        <option value="50">50 kt (маленькая)</option>
        <option value="300">300 kt (средняя)</option>
        <option value="1000">1 Mt (большая)</option>
        <option value="50000">50 Mt (Царь-бомба)</option>
    </select><br>
    <button id="btn">Запустить</button>
</div>

<canvas id="c"></canvas>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
canvas.width = innerWidth;
canvas.height = innerHeight;

// -------------------------
// 1) ГЕНЕРАЦИЯ КАРТЫ
// -------------------------

// Генерация простого силуэта мира
function drawWorld() {
    ctx.fillStyle = "#003366"; // океан
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    ctx.fillStyle = "#228B22"; // зелёная земля

    // Простой континентальный шаблон (не супер точно, но выглядит как карта)
    for (let i = 0; i < 8000; i++) {
        let x = Math.random() * canvas.width;
        let y = Math.random() * canvas.height;

        // фильтры для "континентов"
        if (
            (x > canvas.width*0.05 && x < canvas.width*0.35 && y > canvas.height*0.2 && y < canvas.height*0.8) || 
            (x > canvas.width*0.45 && x < canvas.width*0.75 && y > canvas.height*0.15 && y < canvas.height*0.85) ||
            (x > canvas.width*0.80 && x < canvas.width*0.95 && y > canvas.height*0.25 && y < canvas.height*0.75)
        ) {
            ctx.fillRect(x, y, 3, 3);
        }
    }
}

// -------------------------
// 2) ОБЪЕКТЫ: ДОМА + ДЕРЕВЬЯ
// -------------------------
let buildings = [];
let trees = [];

function spawnObjects() {
    buildings = [];
    trees = [];

    for (let i = 0; i < 250; i++) {
        buildings.push({
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height,
            s: 12 + Math.random()*10,
            destroyed: false
        });
    }

    for (let i = 0; i < 300; i++) {
        trees.push({
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height,
            r: 5 + Math.random()*5,
            burned: false
        });
    }
}

drawWorld();
spawnObjects();

// -------------------------
// 3) ВЗРЫВЫ
// -------------------------
let explosions = [];
let target = {x:null, y:null};

canvas.onclick = e => {
    target.x = e.clientX;
    target.y = e.clientY;
};

document.getElementById("btn").onclick = () => {
    if (target.x == null) return alert("Сначала нажми на карту!");
    let p = Number(document.getElementById("bomb").value);

    explosions.push({
        x: target.x,
        y: target.y,
        r: 0,
        maxR: p * 3,
        rad: p * 5
    });
};

// -------------------------
// 4) ОБНОВЛЕНИЕ
// -------------------------
function update() {

    explosions.forEach(e => {
        if (e.r < e.maxR) e.r += 2;
    });

    buildings.forEach(b => {
        explosions.forEach(e => {
            let d = Math.hypot(b.x - e.x, b.y - e.y);
            if (d < e.r) b.destroyed = true;
        });
    });

    trees.forEach(t => {
        explosions.forEach(e => {
            let d = Math.hypot(t.x - e.x, t.y - e.y);
            if (d < e.rad) t.burned = true;
        });
    });
}

// -------------------------
// 5) РЕНДЕР
// -------------------------
function drawObjects() {
    // Дома
    buildings.forEach(b => {
        ctx.fillStyle = b.destroyed ? "#552222" : "#BBBBBB";
        ctx.fillRect(b.x, b.y, b.s, b.s);
    });

    // Деревья
    trees.forEach(t => {
        ctx.fillStyle = t.burned ? "#331100" : "#009900";
        ctx.beginPath();
        ctx.arc(t.x, t.y, t.r, 0, Math.PI*2);
        ctx.fill();
    });

    // Взрывы
    explosions.forEach(e => {
        ctx.strokeStyle = "rgba(255,200,0,0.9)";
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.arc(e.x, e.y, e.r, 0, Math.PI*2);
        ctx.stroke();

        ctx.strokeStyle = "rgba(0,255,0,0.6)";
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.arc(e.x, e.y, e.rad, 0, Math.PI*2);
        ctx.stroke();
    });
}

// -------------------------
// 6) ГЛАВНЫЙ ЦИКЛ
// -------------------------
function loop() {
    ctx.clearRect(0,0,canvas.width,canvas.height);

    drawWorld();
    drawObjects();
    update();

    requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
