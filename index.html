<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Nuke Simulator v2 - Buildings & Trees</title>
<style>
body{margin:0; background:#0b0b1f; color:#fff; font-family:Segoe UI,sans-serif; display:flex; flex-direction:column; align-items:center;}
#controls{display:flex; gap:10px; flex-wrap:wrap; padding:10px;}
select,button{padding:10px 16px; border:none; border-radius:8px; cursor:pointer; font-weight:600; background:linear-gradient(90deg,#00d4ff,#0066ff); color:#012;}
#canvas{border:2px solid #00bfff; margin-top:10px; border-radius:8px; background:#000; max-width:100%;}
</style>
</head>
<body>
<h2>Симулятор ядерного взрыва с зданиями и деревьями</h2>
<div id="controls">
<select id="bomb">
<option value="1">1 кт</option>
<option value="10">10 кт</option>
<option value="15">15 кт (Хиросима)</option>
<option value="50">50 кт</option>
<option value="100">100 кт</option>
<option value="300">300 кт</option>
<option value="800">800 кт</option>
<option value="1500">1.5 Мт</option>
<option value="5000">5 Мт</option>
<option value="50000">50 Мт (Царь Бомба)</option>
</select>
<button onclick="launch()">Запуск</button>
</div>
<canvas id="canvas" width="1000" height="600"></canvas>
<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
let clickX = null;
let clickY = null;

// --- карта мира ---
const mapImg = new Image();
mapImg.src = "https://upload.wikimedia.org/wikipedia/commons/8/80/World_map_-_low_resolution.png";
mapImg.onload = () => { drawMap(); initObjects(); };

// --- объекты (дома и деревья) ---
let buildings = [], trees = [];
function initObjects(){
  buildings=[]; trees=[];
  for(let i=0;i<50;i++){
    buildings.push({x:Math.random()*canvas.width, y:Math.random()*canvas.height, w:20+Math.random()*30, h:20+Math.random()*50, destroyed:false});
  }
  for(let i=0;i<100;i++){
    trees.push({x:Math.random()*canvas.width, y:Math.random()*canvas.height, r:5+Math.random()*10, destroyed:false});
  }
  drawObjects();
}

// --- рисуем карту и объекты ---
function drawMap(){ ctx.drawImage(mapImg,0,0,canvas.width,canvas.height); }
function drawObjects(){
  buildings.forEach(b=>{
    ctx.fillStyle = b.destroyed?'#111':'#888';
    ctx.fillRect(b.x,b.y,b.w,b.h);
  });
  trees.forEach(t=>{
    ctx.fillStyle = t.destroyed?'#000':'#0a0';
    ctx.beginPath();
    ctx.arc(t.x,t.y,t.r,0,Math.PI*2);
    ctx.fill();
  });
}

// --- клики по карте ---
canvas.addEventListener("click", e=>{
  const rect = canvas.getBoundingClientRect();
  clickX = e.clientX - rect.left;
  clickY = e.clientY - rect.top;
  drawMap();
  drawObjects();
  drawMarker(clickX, clickY);
});

function drawMarker(x,y){
  ctx.strokeStyle = "red";
  ctx.lineWidth = 3;
  ctx.beginPath();
  ctx.arc(x,y,8,0,Math.PI*2);
  ctx.stroke();
}

// --- радиусы ---
function getRadii(kt){
  let mt = kt/1000;
  return {
    fireball: 0.8*Math.pow(mt,0.4)*1000,
    blast: 2.5*Math.pow(mt,0.33)*1000,
    radiation:1.2*Math.pow(mt,0.32)*1000,
    fallout: 20*mt*1000
  };
}

// --- конвертация км в пиксели ---
function kmToPx(km){ return km*(canvas.width/20000); }

// --- рисуем круг ---
function drawCircle(x,y,r,color){ ctx.beginPath(); ctx.strokeStyle=color; ctx.lineWidth=3; ctx.arc(x,y,r,0,Math.PI*2); ctx.stroke(); }

// --- запуск ---
function launch(){
  if(clickX===null) return alert("Кликни по карте!");
  const kt = Number(document.getElementById("bomb").value);
  const radii = getRadii(kt);

  drawMap();
  drawObjects();
  drawMarker(clickX, clickY);

  const fireballPx = kmToPx(radii.fireball);
  const blastPx = kmToPx(radii.blast);
  const radiationPx = kmToPx(radii.radiation);

  // --- анимация ---
  let frame=0;
  let maxFrames=50;
  function animate(){
    drawMap();
    drawObjects();
    drawMarker(clickX, clickY);

    // Fireball
    let fb = fireballPx*frame/maxFrames;
    ctx.fillStyle="rgba(255,165,0,"+(0.6-frame/maxFrames*0.6)+")";
    ctx.beginPath(); ctx.arc(clickX,clickY,fb,0,Math.PI*2); ctx.fill();

    // Blast
    let bl = blastPx*frame/maxFrames;
    ctx.strokeStyle="rgba(255,0,0,"+(0.5-frame/maxFrames*0.5)+")";
    ctx.lineWidth=3;
    ctx.beginPath(); ctx.arc(clickX,clickY,bl,0,Math.PI*2); ctx.stroke();

    // Radiation
    let rad = radiationPx*frame/maxFrames;
    ctx.strokeStyle="rgba(255,255,0,"+(0.4-frame/maxFrames*0.4)+")";
    ctx.lineWidth=2;
    ctx.beginPath(); ctx.arc(clickX,clickY,rad,0,Math.PI*2); ctx.stroke();

    // --- проверка зданий ---
    buildings.forEach(b=>{
      let cx = b.x + b.w/2; let cy = b.y + b.h/2;
      let d = Math.hypot(cx-clickX, cy-clickY);
      if(d<bl) b.destroyed=true; // ударная волна ломает
      if(d<rad) b.destroyed=true; // радиация = обрушение чёрное
    });
    trees.forEach(t=>{
      let d = Math.hypot(t.x-clickX, t.y-clickY);
      if(d<bl) t.destroyed=true;
      if(d<rad) t.destroyed=true;
    });

    drawObjects();
    frame++;
    if(frame<=maxFrames) requestAnimationFrame(animate);
  }
  animate();
}
</script>
</body>
</html>
